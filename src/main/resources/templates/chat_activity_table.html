<!--suppress HtmlDeprecatedAttribute -->
<div xmlns:th="http://www.thymeleaf.org" class="fix-height">
    <!--/*@thymesVar id="activityStatistic" type="java.util.List"*/-->
    <!--/*@thymesVar id="chat" type="org.telegram.telegrambots.meta.api.objects.Chat"*/-->
    <!--/*@thymesVar id="scoreLimit" type="java.lang.Long"*/-->
    <!--/*@thymesVar id="otherSum" type="ru.javazen.telegram.bot.datasource.model.Statistic"*/-->
    <script>
        function expandOtherGroup() {
            $('tr[hidden]').removeAttr('hidden')
            $('#other-group').hide();
        }
    </script>
    <!--suppress HtmlUnknownTag -->
    <style>
        label.custom-control-label {
            position: relative;
            padding-right: 1.25rem;
        }
        label.custom-control-label::before, label.custom-control-label::after{
            right: 0;
            left: auto;
        }
    </style>
    <table class="table table-bordered table-sm bg-white" th:if="${!activityStatistic.isEmpty()}">
        <thead class="thead-light text-center">
        <tr>
            <!--suppress HtmlDeprecatedAttribute-->
            <th width="8%">#</th>
            <th width="37%" th:text="${chat.isUserChat() ? 'Chat' : 'User'}"></th>
            <th width="25%">Activity</th>
            <th width="15%">Messages</th>
            <th width="15%">Characters</th>
        </tr>
        </thead>
        <tbody>
        <tr th:each="item, iter : ${activityStatistic}"
            th:with="hidden = ${scoreLimit != null && item.scorePercentage <= scoreLimit}"
            th:hidden="${hidden}">
            <td class="custom-checkbox text-right">
                <!--suppress HtmlFormInputWithoutLabel -->
                <input class="custom-control-input row-select" type="checkbox" th:checked="${!hidden}" th:id="${item.subject.id}">
                <label class="custom-control-label" th:for="${item.subject.id}" th:text="${iter.index + 1}"></label>
            </td>
            <td th:text="${#strings.abbreviate(item.subject.label, 28)}">
            </td>
            <td>
                <div class="progress" style="height: 1.5rem"
                     th:title="${#numbers.formatInteger(item.score, 0, 'WHITESPACE')} + ' points'">
                    <div class="progress-bar" role="progressbar"
                         th:style="'width: ' + ${item.scorePercentage} + '%; min-width: 1%'">
                        <div th:if="${item.scorePercentage >= 45}"
                             th:text="${item.scorePercentage} + '%'"></div>
                    </div>
                    <div th:if="${item.scorePercentage} < 45" class="ml-2 d-flex flex-column justify-content-center"
                         th:text="${item.scorePercentage} + '%'"></div>
                </div>
            </td>
            <td th:text="${#numbers.formatInteger(item.count, 1, 'WHITESPACE')}" class="text-right"></td>
            <td th:text="${#numbers.formatInteger(item.length, 1, 'WHITESPACE')}" class="text-right"></td>
        </tr>
        <tr th:if="${otherSum != null}" id="other-group">
            <td class="text-right"><div class="btn btn-sm btn-link dropdown-toggle py-0" onclick="expandOtherGroup()"></div></td>
            <td th:text="${otherSum.subject}"></td>
            <td>
                <div class="progress" style="height: 1.5rem"
                     th:title="${#numbers.formatInteger(otherSum.score, 0, 'WHITESPACE')} + ' points'">
                    <div class="progress-bar" role="progressbar"
                         th:style="'width: ' + ${otherSum.scorePercentage} + '%; min-width: 1%'">
                        <div th:if="${otherSum.scorePercentage >= 45}"
                             th:text="${otherSum.scorePercentage} + '%'"></div>
                    </div>
                    <div th:if="${otherSum.scorePercentage} < 45" class="ml-2 d-flex flex-column justify-content-center"
                         th:text="${otherSum.scorePercentage} + '%'"></div>
                </div>
            </td>
            <td th:text="${#numbers.formatInteger(otherSum.count, 1, 'WHITESPACE')}" class="text-right"></td>
            <td th:text="${#numbers.formatInteger(otherSum.length, 1, 'WHITESPACE')}" class="text-right"></td>
        </tr>
        </tbody>
    </table>
    <div class="alert-info p-3 mb-3" th:if="${activityStatistic.isEmpty()}">
        No messages found for the selected period
    </div>
</div>